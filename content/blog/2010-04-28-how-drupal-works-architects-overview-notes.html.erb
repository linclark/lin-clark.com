---
title: "How Drupal Works: An Architect's Overviewâ€”Notes"
date: 2010-04-28
tags: drupal, dcsf@home, api, drupal-planet
---
<p>Through the Lullabot podcasts, Jeff Eaton (and the other Lullabots) gave me my introduction to Drupal. I'm not sure how he packs his Drupal chatter with so much information and hilarity all at the same time, but the combination is definitely one of the things that got me hooked on Drupal.&nbsp;</p><p>So reading quotes from <a id="wjve" title="DCSF&mdash;How Drupal Works: An Architect's Overview" href="http://sf2010.drupal.org/conference/sessions/how-drupal-works-architects-overview">this presentation</a> as they popped up on Twitter is one of the things that made me most angry at the ash cloud. But it is now up online (!) thanks to the amazing DCSF organizers (double !).</p>    <p>Here are my notes. I've removed most of the funny (and got tired at the end), so you should really watch <a id="rkom" title="DCSF&mdash;How Drupal Works: An Architects Overview" href="http://sf2010.drupal.org/conference/sessions/how-drupal-works-architects-overview">the real thing</a>.</p>   
READMORE<hr /><div>The worms eye-view of how a Drupal page is built can be really confusing, but this should help you grok the whole.</div><div>Although technically modules like User and Node are just modules, they are really the core of Drupal's architecture. Sites that you create with Drupal should be sites that thrive when using pieces of content that users create. Recognizing where your plan involves making Drupal into something its not actually good at is step 1.</div> <h2>About Drupal</h2> <ul>   <li>Drupal is modular. That means if you take out all modules, then its just a set of APIs that don't do anything on their own.</li>   <li>Drupal is also event-driven. This fact can be masked to OO programmers by the fact that it is written in procedural PHP. But magically named PHP functions called hooks are the way of interacting with events as they are fired off. Your modules are listening for things to happen and doing something when those things happen. The idea of events and listeners using the hook system is fundamental.</li>   <li>Drupal is skinnable. Everything that a module generates that is going to be seen by an end user should be passed through the theme layer, which is separate from the plugin module that deal with data. This way, they can be transformed into XML, HTML, whatever, through the theme layer. Keeping in mind why drupal has this separation is important. The moment you think about creating a mobile version of your site, you will discover all the places where you forgot the hard coded HTML that you put in your module.</li>   <li>Drupal is organic. Drupal grows and evolves without a central roadmap. People complain about the way something works, and either someone else changes it for them or they try and change it themselves. It's worked pretty well, but there are downsides. For instance, there are three separate queue implementations that basically do the same thing.</li> </ul> <h2>API layer</h2> <div>Stuff that lives inside of the includes directory are the APIs, the core that make Drupal what it is. All modules sit on top of these services. The theme lives on top of that.</div> <h3>Menu API</h3> <div>Handles several key tasks. It does what other frameworks call routing. When a url is entered, it figures out which function it should use to build a page. It also magically builds convenient navigation menus and breadcrumb trails.</div> <h3>Database Abstraction</h3><p>Sits there and allows us to make database queries against any database that someone has written a driver for. In Drupal 7, this gets easier since we're using PDO, a standard PHP library.&nbsp;</p><h3>Session Handling</h3> <div>Drupal tracks the use of all logged in users across multiple web hits. It allows you to swap out the storage mechanism for this.</div> <h3>Output Filtering</h3> <div>Handles scrubbing out nasty JavaScript and other filtering.</div> <h3>Caching</h3> <div>The ability to store the generated output for a page so Drupal doesn't have to generate it again for every page request.</div> <h3>Batch Processing</h3> <div>Multistage operations where you need to reload pages while chewing through thousands of nodes.</div> <h3>Module system</h3> <div>The fact that we can load modules from a folder and use the hook system to announce events for them.</div> <h3>Update system</h3><p>Allows us to keep track of which schema pieces have fallen out of sync with the module code.</p><h3>Unicode utilities</h3> <div>We can run lots of functions that ensure that localization doesn't do funky things with the text in the other language.<br />   <br />   <div><font size="3"><b>Other APIs</b></font></div>   <ul>     <li><font size="2">File storage</font></li>     <li><font size="2">Locale &amp; Language</font></li>     <li><font size="2">Themeing (Rendering)</font></li>     <li><font size="2">Forms &amp; Processing</font></li>     <li><font size="2">Image Manipulation</font></li>     <li><font size="2">Email handling</font></li>     <li><font size="2">XMLRPC</font></li>   </ul></div> <h2>Page Request Process</h2> <ol>   <li>Someone fires a request to your webserver. They might get a cookie if they've already logged into the site.</li>   <li>The server gets the request. It goes to .htaccess which says everything should go to index.php</li>   <li>index.php loads the APIs and gets them ready to handle the request</li>   <li>The Menu API which was loaded looks up the paths that different modules have registered that they handle.</li>   <li>The module gets the request and fires hooks to see whether any module wants to help while it's building the page.</li>   <li>The module returns some info back to the menu system.</li>   <li>If the everything looks good, it figures out which theme is active and hands off the raw data to the theme layer.</li>   <li>That gets kicked back to Drupal.</li>   <li>That gets kicked back to the web server, which kicks it back to the user.</li> </ol> <h2>Drupalisms</h2> <h3>Hooks</h3> <div>The hook system is an event listener that was cobbled together out of the function_exists functionality of PHP.&nbsp;</div> <h3>Info Arrays</h3><p>Drupal uses giant nested arrays to pass information around. You can stick anything in arrays, so you have to look at the API docs to figure out the different structures of the arrays in the APIs.</p><h3>Callbacks</h3><p>In an array, you stick a PHP function name in specific places. When the array is being processed, the function will be called.</p><h3>Renderables</h3> <div>Arrays created by Form API and Node. In Drupal 7, the entire structure of the page is in a renderable. It's XML as an array. If it doesn't have a hash sign in front, it is a nested element. If it does have a hash sign, it is a property of its parent element.</div> <h3>Alter Hooks</h3><p>The payoff for all the crazy array stuff. Drupal asks if anyone wants to change these arrays before they get fully rendered. It allows you to customize the guts of how other modules work without messing with their code.<br />&nbsp;</p>